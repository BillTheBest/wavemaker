<project name="importdb" default="import-db" basedir=".">
    <description>
        Imports a database.  Useful for testing the import process.
        Note - now that jdbc jars are in modules, you'll need to manually include them on the
        classpath.
    </description>

    <property name="root.dir" location="../../.."/>
    <import file="${root.dir}/common.build.xml"/>


    <property name="tmp" location="${basedir}/tmp"/>
    <property name="importdb" location="${basedir}/importdbtest"/>


    <target name="clean">
        <delete dir="${tmp}"/>
        <delete dir="${importdb}"/>
    </target>

    <target name="import-db" depends="standalone-jar">
        <java classname="importdb" classpath="${testruntime.jar}" fork="true">
            <!--sysproperty key="user.language" value="fr"/-->
            <sysproperty key="wm.importdb.serviceClass" value="com.wm.Sakila"/>
            <sysproperty key="wm.importdb.outputDir" value="${importdb}/src"/>
            <sysproperty key="wm.importdb.classesDir" value="${importdb}/classes"/>
            <sysproperty key="wm.importdb.genServiceClass" value="true"/>
            <sysproperty key="wm.importdb.genServiceMain" value="true"/>
            <sysproperty key="wm.importdb.username" value="root"/>
            <sysproperty key="wm.importdb.password" value="root"/>
            <sysproperty key="wm.importdb.connectionUrl" value="jdbc:mysql://localhost:3306/sakila"/>

            <sysproperty key="wm.importdb.tableFilter" value="city,country"/>
            <!--sysproperty key="wm.importdb.schemaFilter" value="STOENS"/-->
            <sysproperty key="wm.importdb.regenerate" value="true"/>
            <!--sysproperty key="wm.importdb.useIndividualCRUDOperations" value="true"/-->

            <!--sysproperty key="wm.importdb.connectionUrl" value="jdbc:jtds:sqlserver://localhost/test;instance=SQLEXPRESS"/-->
        <!--sysproperty key="wm.importdb.connectionUrl" value="jdbc:hsqldb:file:../demos/RolodexSimple/services/rolodexdb/rolodex;shutdown=true;ifexists=true,USER=sa"/-->
            <!--arg value="${test.dbservices.dir}/mysql_sakila.properties"/-->
            <!--arg value="values"/-->
        </java>
    </target>

    <target name="standalone-jar">

        <property name="testruntime.jar" location="${tmp}/testruntime.jar"/>

	<mkdir dir="${tmp}"/>

        <copy file="${hibernate.jar}" todir="${tmp}"/>
        <copy file="${hibernate-ext.jar}" todir="${tmp}"/>
        <copy file="${freemaker.jar}" todir="${tmp}"/>
        <copy file="${jtidy.jar}" todir="${tmp}"/>
        <copy file="${apache-logging.jar}" todir="${tmp}"/>
        <copy file="${apache-logging.jar}" todir="${tmp}"/>
        <copy file="${apache-lang.jar}" todir="${tmp}"/>
        <copy file="${dom4j.jar}" todir="${tmp}"/>
        <copy file="${cglib.jar}" todir="${tmp}"/>
        <copy file="${asm.jar}" todir="${tmp}"/>
        <copy file="${apache-collections.jar}" todir="${tmp}"/>
        <copy file="${apache-io.jar}" todir="${tmp}"/>
        <copy file="${antlr.jar}" todir="${tmp}"/>
        <copy file="${jaxb-xjc.jar}" todir="${tmp}"/>
        <copy file="${jaxb-impl.jar}" todir="${tmp}"/>
        <copy file="${jaxb-api.jar}" todir="${tmp}"/>
        <copy file="${activation.jar}" todir="${tmp}"/>
        <copy file="${mysql-connector.jar}" todir="${tmp}"/>
        <copy file="${db2.jar}" todir="${tmp}"/>
        <copy file="${jtds.jar}" todir="${tmp}"/>
        <copy file="${log4j.jar}" todir="${tmp}"/>
        <copy file="${ant.jar}" todir="${tmp}"/>
        <copy file="${ant-nodeps.jar}" todir="${tmp}"/>
        <copy file="${spring.jar}" todir="${tmp}"/>
        <copy file="${spring-webmvc.jar}" todir="${tmp}"/>
        <copy file="${jta.jar}" todir="${tmp}"/>
        <copy file="${stax.jar}" todir="${tmp}"/>
        <copy file="${jsr173_api.jar}" todir="${tmp}"/>
        <copy file="${hsql.jar}" todir="${tmp}"/>
        <copy file="${postgresql.jar}" todir="${tmp}"/>
        <copy file="${wmcommon.jar}" todir="${tmp}"/>
        <copy file="${wmruntime.jar}" todir="${tmp}"/>
        <copy file="${wmtools.jar}" todir="${tmp}"/>

        <jar destfile="${testruntime.jar}" basedir="${src.runtime.dir}">
            <manifest>
                <attribute name="Class-Path" value="${wmcommon.jar.name} ${wmruntime.jar.name} ${wmtools.jar.name} ${spring.jar.name} ${spring-webmvc.jar.name} ${hibernate.jar.name} ${hibernate-ext.jar.name} ${jtidy.jar.name} ${apache-logging.jar.name} ${apache-lang.jar.name} ${apache-io.jar.name} ${dom4j.jar.name} ${cglib.jar.name} ${asm.jar.name} ${apache-collections.jar.name} ${antlr.jar.name} ${jaxb-xjc.jar.name} ${jaxb-api.jar.name} ${jaxb-impl.jar.name} ${activation.jar.name} ${mysql-connector.jar.name} ${postgresql.jar.name} ${db2.jar.name} ${jtds.jar.name} ${hsql.jar.name} ${log4j.jar.name} ${ant.jar.name} ${ant-nodeps.jar.name} ${freemaker.jar.name} ${jta.jar.name} ${jsr173_api.jar.name} ${stax.jar.name} ${apache-fileupload.jar.name}"/>
            </manifest>
            <include name="log4j.properties"/>
        </jar>
    </target>

</project>
