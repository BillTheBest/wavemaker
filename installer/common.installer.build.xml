<!--
   -  Copyright (C) 2011 VMWare, Inc. All rights reserved.
   -
   -  Licensed under the Apache License, Version 2.0 (the "License");
   -  you may not use this file except in compliance with the License.
   -  You may obtain a copy of the License at
   -     http://www.apache.org/licenses/LICENSE-2.0
   -  Unless required by applicable law or agreed to in writing, software
   -  distributed under the License is distributed on an "AS IS" BASIS,
   -  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   -  See the License for the specific language governing permissions and
   -  limitations under the License.
-->
<project name="shared-installers" default="" basedir=".">
    <description>
        This script contains shared tasks used by the installers.
    </description>

    <property name="port" value="8094" />

	<condition property="isEnterprise">
        <equals arg1="${project.type}" arg2="enterprise"/>
    </condition>
    
      <target name="common-installer.generate-dist"
            description="Generate the installer dist; depends on 'installer.wm.root' being set">
        <mkdir dir="${installer.wm.root}"/>
        <mkdir dir="${installer.wm.root}/Support"/>
        <copy todir="${installer.wm.root}/Support">
            <fileset dir="${root.dir}/../Support">
                <exclude name="**/.svn"/>
				<exclude name="**/Batchbuild/**" unless="isEnterprise"/>
            </fileset>
        </copy>

        <mkdir dir="${installer.wm.root}/Samples"/>
        <copy todir="${installer.wm.root}/Samples">
            <fileset dir="${root.dir}/demos">
                <exclude name="**/.svn"/>
            </fileset>
        </copy>

        <copy todir="${installer.wm.root}/launcher">
            <fileset dir="${dist.launcher.dir}"/>
        </copy>

        <copy todir="${installer.wm.root}/studio">
            <fileset dir="${dist.studio.dir}">
				<exclude name="**/RbacPlugin.js" unless="isEnterprise"/>
				<exclude name="**/DojoFlashFileUpload.js" unless="isEnterprise"/>
			</fileset>
        </copy>
        
        <mkdir dir="${installer.wm.root}/studioConfig"/>
        <copy todir="${installer.wm.root}/studioConfig">
            <fileset dir="${dist.studioConfig.dir}"/>
        </copy>

        <copy todir="${installer.wm.root}">
            <fileset dir="${build.dir}">
                <include name="VERSION"/>
            </fileset>
        </copy>
    </target>
      
  <target name="common-installer.generate-dist-nojdk"
            description="Generate the installer dist; depends on 'installer.wm.nojdk.root' being set">
        <mkdir dir="${installer.wm.nojdk.root}"/>
        <mkdir dir="${installer.wm.nojdk.root}/Support"/>
        <copy todir="${installer.wm.nojdk.root}/Support">
          <fileset dir="${root.dir}/../Support">
             <exclude name="**/.svn"/>
					   <exclude name="**/Batchbuild/**" unless="isEnterprise"/>
          </fileset>
        </copy>

        <mkdir dir="${installer.wm.nojdk.root}/Samples"/>
        <copy todir="${installer.wm.nojdk.root}/Samples">
          <fileset dir="${root.dir}/demos">
            <exclude name="**/.svn"/>
          </fileset>
        </copy>

        <copy todir="${installer.wm.nojdk.root}/launcher">
            <fileset dir="${dist.launcher.dir}"/>
        </copy>

        <copy todir="${installer.wm.nojdk.root}/studio">
          <fileset dir="${dist.studio.dir}">
						<exclude name="**/RbacPlugin.js" unless="isEnterprise"/>
						<exclude name="**/DojoFlashFileUpload.js" unless="isEnterprise"/>
					</fileset>
        </copy>

        <mkdir dir="${installer.wm.root}/studioConfig"/>
        <copy todir="${installer.wm.root}/studioConfig">
            <fileset dir="${dist.studioConfig.dir}"/>
        </copy>
        
        <copy todir="${installer.wm.nojdk.root}">
            <fileset dir="${build.dir}">
              <include name="VERSION"/>
            </fileset>
        </copy>
    </target>
  
    <target name="common-installer.clean">
        <delete dir="${installer.wm.nojdk.root}"/>
	  </target>
</project>
